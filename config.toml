# Brainchain Configuration

# === Orchestrator ===
# brainchain 실행 시 이 에이전트의 CLI를 직접 실행
# 사용자 환경에 맞게 변경 가능: "claude", "codex", "gemini" 등
[orchestrator]
agent = "claude"
prompt_file = "prompts/orchestrator.md"

# === Interactive Agents (orchestrator용) ===
# brainchain 명령 시 직접 실행되는 CLI

[agents.claude]
command = "claude"
args = ["--permission-mode", "acceptEdits"]

[agents.codex]
command = "codex"
args = ["--full-auto", "--skip-git-repo-check"]

[agents.gemini]
command = "gemini"
args = ["--sandbox"]

# === Base Templates (prefix with _ to indicate template) ===
# 템플릿은 직접 사용하지 않고 extends로 상속받아 사용

[agents._claude-task]
command = "claude"
args = ["-p", "{prompt}", "--print", "--permission-mode", "acceptEdits"]
timeout = 300

[agents._codex-task]
command = "codex"
args = ["exec", "{prompt}", "--full-auto", "--skip-git-repo-check"]
timeout = 300

# === Task Agents (extends 사용) ===

[agents.claude-opus-high]
extends = "_claude-task"
model = "opus"
timeout = 600

[agents.claude-opus]
extends = "_claude-task"
model = "opus"

[agents.claude-opus-low]
extends = "_claude-task"
model = "opus"
timeout = 120

[agents.claude-sonnet]
extends = "_claude-task"
model = "sonnet"

[agents.claude-haiku]
extends = "_claude-task"
model = "haiku"
timeout = 60

[agents.claude-haiku-web]
extends = "_claude-task"
model = "haiku"
args = ["-p", "{prompt}", "--print", "--permission-mode", "acceptEdits", "--allowedTools", "WebSearch,WebFetch"]
timeout = 90

[agents.claude-web]
extends = "_claude-task"
model = "opus"
args = ["-p", "{prompt}", "--print", "--permission-mode", "acceptEdits", "--allowedTools", "WebSearch,WebFetch"]
timeout = 600

[agents.codex-exec]
extends = "_codex-task"
model = "gpt-5.2"

[agents.codex-gpt5]
extends = "_codex-task"
model = "gpt-5.2"
args = ["exec", "{prompt}", "--full-auto", "--skip-git-repo-check", "-c", "model_reasoning_effort=\"high\""]

[agents.codex-coder]
extends = "_codex-task"
model = "gpt-5.2-codex"
args = ["exec", "{prompt}", "--full-auto", "--skip-git-repo-check", "-c", "model_reasoning_effort=\"high\""]
timeout = 600

[agents.gemini-exec]
command = "gemini"
args = ["-p", "{prompt}", "--sandbox"]
timeout = 300

# === Roles (agent + prompt combinations) ===

[roles.planner]
agent = "claude-web"
prompt_file = "prompts/planner.md"

[roles.plan_validator]
agent = "codex-gpt5"
prompt_file = "prompts/plan_validator.md"

[roles.implementer]
agent = "claude-opus-high"
prompt_file = "prompts/implementer.md"

[roles.code_reviewer]
agent = "codex-coder"
prompt_file = "prompts/code_reviewer.md"

[roles.fixer]
agent = "claude-opus-high"
prompt_file = "prompts/fixer.md"

# Utility roles (Haiku - fast/cheap)
[roles.doc_reader]
agent = "claude-haiku"
prompt_file = "prompts/doc_reader.md"

[roles.db_reader]
agent = "claude-haiku"
prompt_file = "prompts/db_reader.md"

[roles.summarizer]
agent = "claude-haiku"
prompt_file = "prompts/summarizer.md"

[roles.researcher]
agent = "claude-haiku-web"
prompt_file = "prompts/researcher.md"

# Exploration roles (cheap/fast search)
[roles.explore]
agent = "claude-haiku"
prompt_file = "prompts/explore.md"

[roles.librarian]
agent = "claude-haiku-web"
prompt_file = "prompts/librarian.md"

[roles.analyst]
agent = "claude-opus"
prompt_file = "prompts/analyst.md"

# === Workflow ===

[[workflow.steps]]
role = "planner"
output = "plan.json"

[[workflow.steps]]
role = "plan_validator"
input = "plan.json"
on_fail = "goto:planner"

[[workflow.steps]]
role = "implementer"
input = "plan.json"
per_task = true

[[workflow.steps]]
role = "code_reviewer"
per_task = true
on_fail = "goto:fixer"

[[workflow.steps]]
role = "fixer"
on_success = "goto:code_reviewer"

# === Execution Settings ===

[retry_policy]
max_retries = 3
retry_delay = 5

[parallel]
max_workers = 5

# === Session Management ===

[session]
enabled = true
auto_save = true
retention_days = 30
# db_path = "~/.config/brainchain/sessions.db"

[session.recovery]
auto_detect = true
prompt_resume = true

# === MCP (Model Context Protocol) ===
# Optional: Enable MCP servers for enhanced capabilities

[mcp]
enabled = false
connect_timeout = 10

# Example MCP server configuration:
# [mcp.servers.filesystem]
# enabled = true
# command = ["npx", "-y", "@anthropics/mcp-server-filesystem", "/path/to/dir"]
